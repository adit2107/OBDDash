<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- <script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?key=AjkXX1zT7YHy-_LtxMnidsm-asX1f__I79nFe4BBo2ELOe233gyXIRQnNDK9I1_I&callback=loadMapScenario' async defer></script> -->
  <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=loadMapScenario' async defer></script>
  <link rel="stylesheet" href="https://bootswatch.com/3/paper/bootstrap.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.4.0/gridstack.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.0/jquery-ui.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.0/lodash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.4.0/gridstack.all.js"></script>
  <script type="text/javascript" src=" http://cdn.fusioncharts.com/fusioncharts/latest/fusioncharts.js"></script>
  <script type="text/javascript" src=" http://cdn.fusioncharts.com/fusioncharts/latest/fusioncharts.theme.fusion.js"></script>
  <script type="text/javascript" src="js/ft.js"></script>
  <style>
  .grid-stack > .grid-stack-item > .grid-stack-item-content{
    overflow-y: hidden;
  }
  </style>
</head>
<body>
  <div class="container">
  		<div class="row">
  			<div class="col-sm-12 text-center">
  				<h2>OBD Live Dashboard</h2>
  			</div>
  			<div class="col-sm-12 well">
  				<div class="grid-stack" staticGrid="true">
  					<div class="grid-stack-item" data-gs-x="8" data-gs-y="0" data-gs-width="4" data-gs-height="4">
  						<div class="grid-stack-item-content panel panel-primary">
  							<div class="panel-heading text-center">
  								<h3 class="panel-title">Engine Load</h3>
  							</div>
  							<div class="panel-body">
  							</div>
  						</div>
  					</div>
  					<div class="grid-stack-item" data-gs-x="0" data-gs-y="0" data-gs-width="8" data-gs-height="4">
  						<div class="grid-stack-item-content panel panel-primary">
  							<div class="panel-heading text-center">
  								<h3 class="panel-title">Car Statistics</h3>
  							</div>
  							<div class="panel-body">
  							</div>
  						</div>
  					</div>
  					<div class="grid-stack-item" data-gs-x="3" data-gs-y="4" data-gs-width="3" data-gs-height="2">
  						<div class="grid-stack-item-content panel panel-primary">
  							<div class="panel-heading text-center">
  								<h3 class="panel-title">Coolant Temperature</h3>
  							</div>
  							<div id="chart-container">
  							</div>
  						</div>
  					</div>
            <div class="grid-stack-item" data-gs-x="3" data-gs-y="6" data-gs-width="3" data-gs-height="2">
  						<div class="grid-stack-item-content panel panel-primary">
  							<div class="panel-heading text-center">
  								<h3 class="panel-title">Throttle Position</h3>
  							</div>
  							<div class="panel-body">
  							</div>
  						</div>
  					</div>
            <div class="grid-stack-item" data-gs-x="0" data-gs-y="4" data-gs-width="3" data-gs-height="2">
  						<div class="grid-stack-item-content panel panel-primary">
  							<div class="panel-heading text-center">
  								<h3 class="panel-title">Panel</h3>
  							</div>
  							<div id="rpmdiv" class="panel-body">
  							</div>
  						</div>
  					</div>
            <div class="grid-stack-item" data-gs-x="0" data-gs-y="6" data-gs-width="3" data-gs-height="2">
  						<div class="grid-stack-item-content panel panel-primary">
  							<div class="panel-heading text-center">
  								<h3 class="panel-title">Panel</h3>
  							</div>
  							<div id="speeddiv" class="panel-body">
  							</div>
  						</div>
  					</div>
            <div class="grid-stack-item" data-gs-x="6" data-gs-y="4" data-gs-width="6" data-gs-height="4">
  						<div class="grid-stack-item-content panel panel-primary">
  							<div class="panel-heading text-center">
  								<h3 class="panel-title">GPS Co-ordinates</h3>
  							</div>
                  <div id="bingmap">
  					</div>
  				</div>
  			</div>
  		</div>
  	</div>
  </div>
</div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
<script type="text/javascript">
var socket = io.connect('http://localhost:3001');
socket.on('speed', function(data){
  //alert(data["speed"]);
});
socket.on('coolant', function(data){
   //alert(data["coolant"]);
});
socket.on('rpm', function(data){
  // alert(data["rpm"]);
});
socket.on('engine', function(data){
  // alert(data["engine"]);
});
socket.on('tp', function(data){
  // alert(data["tp"]);
});
socket.on('coord', function(data){
  loadMapScenario(data.x, data.y);
  // UsersLocationUpdated(data.x, data.y);
});

var options = {
  staticGrid: true
}
$(function () {
    $('.grid-stack').gridstack(options);
});

function GetMap()
  {
      map = new Microsoft.Maps.Map('#bingmap', {
      credentials: 'AjkXX1zT7YHy-_LtxMnidsm-asX1f__I79nFe4BBo2ELOe233gyXIRQnNDK9I1_I'
      });
  }

function StartTracking() {
      //Add a pushpin to show the user's location.
      userPin = new Microsoft.Maps.Pushpin(map.getCenter(), { visible: false });
      map.entities.push(gpsPin);

      //Watch the users location.
      watchId = navigator.geolocation.watchPosition(UsersLocationUpdated);
  }

function UsersLocationUpdated(x, y) {
  var loc = new Microsoft.Maps.Location(x, y);

      //Update the user pushpin.
  userPin.setLocation(loc);
  userPin.setOptions({ visible: true });

      //Center the map on the user's location.
  map.setView({ center: loc });
  }

function loadMapScenario(x, y){
var map = new Microsoft.Maps.Map(document.getElementById('bingmap'), {});
Microsoft.Maps.loadModule('Microsoft.Maps.Search', function () {
    var searchManager = new Microsoft.Maps.Search.SearchManager(map);
    var reverseGeocodeRequestOptions = {
        location: new Microsoft.Maps.Location(x, y),
        callback: function (answer, userData) {
            map.setView({ bounds: answer.bestView });
            map.entities.push(new Microsoft.Maps.Pushpin(reverseGeocodeRequestOptions.location));
        }
    };
    searchManager.reverseGeocode(reverseGeocodeRequestOptions);
});
}

</script>
</html>
